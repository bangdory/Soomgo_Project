<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.soomgo.soomgo_project.mappers.communityReply.CommunityReplyMapper">
    <insert id="create" parameterType="org.soomgo.soomgo_project.domain.communityReply.CommunityReplyDTO">
        insert into community_reply (
            cb_no,
            cr_content,
            cr_file,
            user_num
        )
        values (
            #{cb_no},
            #{cr_content},
            #{cr_file},
            #{user_num}
        )
    </insert>
    <select id="readAll" resultType="org.soomgo.soomgo_project.domain.communityReply.CommunityReplyDTO">
        select
            cb_no,
            cr_no,
            cr_content,
            cr_file,
            user_num,
            cr_like,
            cr_regdate
        from community_reply
        where cb_no = #{cb_no}
    </select>
    <update id="update">
        update community_reply
        set
            cr_content,
            cr_file
        where cr_no = #{cr_no}
    </update>
    <delete id="delete">
        delete from community_reply where cr_no = #{cr_no}
    </delete>
    <select id="isLiked" parameterType="map" resultType="boolean">
        select count(1) > 0
        from likeCount
        where cr_no = #{cr_no} and user_num = #{user_num}
    </select>
    <insert id="increaseLike" parameterType="map">
        insert into likeCount (user_num, cr_no)
        values (#{user_num}, #{cr_no})
    </insert>
    <update id="updateLikeCount" parameterType="map">
        update community_reply
        set like = like +1
        where cr_no = #{cr_no}
    </update>
    <delete id="removeLike" parameterType="map">
        delete from likeCount
        where cr_no = #{cr_no} and user_num = #{user_num}
    </delete>
    <update id="decrementLikeCount" parameterType="map">
        update community_reply
        set like = like -1
        where cr_no = #{cr_no}
    </update>
    <select id="getLikeCount" parameterType="int" resultType="int">
        select cr_like
        from community_reply
        where cr_no = #{cr_no}
    </select>
</mapper>